<?xml version="1.0" encoding="UTF-8"?><script><script_id>36:WPDS</script_id><name>Check Workorder for Completion</name><script_type_id>13</script_type_id><row_version>99</row_version><lu_id>SNEHAI</lu_id><lu_date>2015-10-27T00:57:53</lu_date><false_msg/><description/><emit_events>0</emit_events><script_line><script_line_id>113:TEST</script_line_id><script_id>36:WPDS</script_id><sequence>1</sequence><script_class_id>7</script_class_id><source_name>LOCAL</source_name><row_version>1</row_version><lu_id>SNEHAI</lu_id><lu_date>2015-10-27T00:57:53</lu_date><statement>//[lf]// request = {[lf]//               'ServiceOrder' : { 'Key' : {'ServiceOrderId':soid }, },[lf]//                  }[lf][lf]// Standard Java Files[lf]importPackage(Packages.java.math);[lf]importPackage(Packages.java.lang);[lf]importPackage(Packages.java.util);[lf][lf]// Workpoint Files[lf]importPackage(Packages.com.workpoint.client);[lf]importPackage(Packages.com.workpoint.common.util);[lf]importPackage(Packages.com.workpoint.common.data);[lf]// Security Files[lf]importPackage(Packages.com.csgsystems.fx.security);[lf]// Bali Files[lf]importPackage(Packages.com.csgsystems.bali.connection);[lf]importPackage(Packages.com.csgsystems.aruba.connection);[lf][lf]importPackage(Packages.com.workpoint.common.logging);[lf][lf]logger = WPLogger.getLogger("com.workpoint.comverse.CheckWorkorderCompletion");[lf][lf]logger.warn("WARN: DelayNode: " + SymbolTable.getSymbol("NodeInstIDStr").getPrimaryValue());[lf] [lf]try[lf]{[lf]  sm = SecurityManagerFactory.createSecurityManager ();[lf]  connfact = new ConnectionFactory();[lf]  settings = BSDMSettings.getDefault();[lf]  conn =connfact.createConnection(settings);[lf][lf]  equalmap = new HashMap();[lf]  resmap = new HashMap();[lf][lf]  equalmap.put("Equal", ThisJobData.getBulkUserDataString("ServiceOrderId"));[lf]  resmap.put("ServiceOrderId", equalmap);[lf]  resmap.put("Fetch", new Integer(1));[lf][lf]  reqestmap = new HashMap();[lf]  reqestmap.put("WorkOrder", resmap);[lf][lf]  session = BSDMSessionContext.getDefaultContext();[lf]  session.setSecurityContext(sm);[lf]  serverid = new Integer(ThisJobData.getBulkUserDataString("CustomerServerId"));[lf]  session.setServerId(serverid);[lf][lf]  response = conn.call(session, ApiMappings.getCallName ("WorkOrderFind"), reqestmap);[lf][lf]  logger.warn("Response: " + response);[lf][lf]  // Check for Status in response[lf]  if (response != null)[lf]  {[lf]    var wolist = new HashMap();[lf]    wolist = response.get("WorkOrderList");[lf][lf]    statusid = 0;[lf][lf]    if (wolist == null)[lf]   {[lf]      ThisJobData.setBulkUserData("WorkOrder", "None");[lf]      SymbolTable.add("Result1").setValue( 0, 'TRUE' );[lf]    }[lf]    else[lf]    {[lf]      womap = wolist[0]; [lf]      statusid = womap.get("StatusId");[lf]      logger.warn("status id: " + statusid);[lf]      if (statusid == 16 || statusid == 15)  // complete[lf]      {[lf]         ThisJobData.setBulkUserData("WorkOrder", "Complete");[lf]         SymbolTable.add("Result1").setValue( 0, 'TRUE' );[lf]      }[lf]      else if (statusid == 17)[lf]      {[lf]         ThisJobData.setBulkUserData("WorkOrder", "Hold");[lf]         SymbolTable.add("Result1").setValue( 0, 'FALSE' );[lf]      }[lf]      else if (statusid == 18)[lf]      {[lf]         ThisJobData.setBulkUserData("WorkOrder", "Canceled");[lf]         SymbolTable.add("Result1").setValue( 0, 'TRUE' );[lf]      }[lf]      else if (statusid == 19)[lf]      {[lf]         ThisJobData.setBulkUserData("WorkOrder", "Waived");[lf]         SymbolTable.add("Result1").setValue( 0, 'TRUE' );[lf]      }[lf]      else[lf]        SymbolTable.add("Result1").setValue( 0, 'FALSE' );[lf]     }[lf]   }[lf]   else[lf]      SymbolTable.add("Result1").setValue( 0, 'FALSE' );[lf]}[lf]catch(e)[lf]{[lf]   msg = e.message;[lf]   logger.warn("Caught exception: " + e);[lf]   if (msg.indexOf("ck_SELECT_NOT_FOUND")) [lf]  {[lf]     ThisJobData.setBulkUserData("WorkOrder", "None");[lf]     SymbolTable.add("Result1").setValue( 0, 'TRUE' );[lf]   }[lf]   else[lf]   {[lf]      java.lang.System.out.println("exception: " + e);[lf]      // need to complete node with code[lf]      Job.recordError(ClientContext, [lf]                                 new TableID(SymbolTable.getSymbol("ProcInstIDStr").getPrimaryValue()),[lf]                                 "exception, see logs for details"); [lf]   }[lf]}</statement><name/><validation_status>0</validation_status><validation_status_msg/></script_line><validation_status>0</validation_status></script>