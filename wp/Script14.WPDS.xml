<?xml version="1.0" encoding="UTF-8"?><script><script_id>14:WPDS</script_id><name>ServiceOrderCompleteAPICall</name><script_type_id>3</script_type_id><row_version>59</row_version><lu_id>SNEHAI</lu_id><lu_date>2015-10-27T00:55:29</lu_date><false_msg/><description/><emit_events>0</emit_events><script_line><script_line_id>140:TEST</script_line_id><script_id>14:WPDS</script_id><sequence>1</sequence><script_class_id>7</script_class_id><source_name>LOCAL</source_name><row_version>1</row_version><lu_id>SNEHAI</lu_id><lu_date>2015-10-27T00:55:29</lu_date><statement>// Standard Java Files[lf]importPackage(Packages.java.math);[lf]importPackage(Packages.java.lang);[lf]importPackage(Packages.java.util);[lf][lf]// Workpoint Files[lf]importPackage(Packages.com.workpoint.client);[lf]importPackage(Packages.com.workpoint.common.util);[lf]importPackage(Packages.com.workpoint.common.data);[lf]// Security Files[lf]importPackage(Packages.com.csgsystems.fx.security);[lf]// Bali Files[lf]importPackage(Packages.com.csgsystems.bali.connection);[lf]importPackage(Packages.com.csgsystems.aruba.connection);[lf][lf]importPackage(Packages.com.workpoint.common.logging);[lf][lf]logger = WPLogger.getLogger("com.workpoint.comverse.SOA");[lf][lf]logger.info("INFO: ActivityInstId: " + [lf]    SymbolTable.getSymbol("ActInstIDStr").getPrimaryValue() +[lf]    " Iteration: " + SymbolTable.getSymbol("WorkItemIteration").getPrimaryValue());[lf][lf]try[lf]{[lf]   // Check to see if this script is ran in a subjob[lf]   if (ThisJobData.getJobParentID())[lf]  {[lf]     job = Job.queryByID(ClientContext, ThisJobData.getJobParentID(), true);[lf]     soid =job.getBulkUserDataString("ServiceOrderId");[lf]     comdate = job.getBulkUserDataString("CompleteDate");[lf]     oid = job.getBulkUserDataString("OrderId");[lf]     serverid = new Integer(job.getBulkUserDataString("CustomerServerId"));[lf]   }[lf]   else[lf]   {[lf]      soid = ThisJobData.getBulkUserDataString("ServiceOrderId");[lf]      comdate = ThisJobData.getBulkUserDataString("CompleteDate");[lf]      oid = ThisJobData.getBulkUserDataString("OrderId");[lf]      serverid = new Integer(ThisJobData.getBulkUserDataString("CustomerServerId"));[lf]    }[lf]    logger.debug("DEBUG: ServiceOrderId " + soid);[lf]    logger.debug("DEBUG: CompleteDate " + comdate);[lf]    logger.debug("DEBUG: OrderId " + oid);[lf]    logger.debug("DEBUG: CustomerServerId " + serverid);[lf][lf]  sm = SecurityManagerFactory.createSecurityManager ();[lf]  connfact = new ConnectionFactory();[lf]  conn =connfact.createConnection(BSDMSettings.getDefault ());[lf][lf]  keymap = new HashMap();[lf]  resmap = new HashMap();[lf][lf]  keymap.put("ServiceOrderId", soid);[lf][lf]  resmap.put("CompleteDt", comdate);[lf]  resmap.put("OrderId", oid);[lf]  resmap.put("CustomerServerId",serverid);[lf]  resmap.put("Key", keymap);[lf][lf]  reqestmap = new HashMap();[lf]  reqestmap.put("ServiceOrder", resmap);[lf][lf]  session = BSDMSessionContext.getDefaultContext();[lf]  session.setSecurityContext(sm);[lf]  session.setServerId(serverid);[lf][lf]  logger.debug("DEBUG: Calling ServiceOrderComplete");[lf]  reqestmap = conn.call(session, ApiMappings.getCallName ("ServiceOrderComplete"), reqestmap);[lf]}[lf]catch(e)[lf]{[lf]  java.lang.System.out.println("exception: " + e);[lf]  // need to complete node with code[lf]  [lf]  SymIteration = SymbolTable.getSymbol("WorkItemIteration").getPrimaryValue();[lf]  activity = new TableID(SymbolTable.getSymbol("ActInstIDStr").getPrimaryValue());[lf]  work = WorkItemEntry.queryByID(ClientContext, activity, SymIteration);[lf][lf]  if( work != null )[lf] {[lf]    workstate = work.getWorkStateID();[lf]    if( workstate == WorkItemConst.WORK_STATE_AVAILABLE ) // Available[lf]      work.open();[lf][lf]   if (  e.message.indexOf('op_SO_LOCKED_COM') != -1)[lf]     work.changeState(WorkItemConst.WORK_STATE_COMPLETE, 0, 52, "exception: " + e);[lf]   else[lf]      work.changeState(WorkItemConst.WORK_STATE_COMPLETE, 0, 60, "exception: " + e);[lf]  }[lf]}</statement><name/><validation_status>0</validation_status><validation_status_msg/></script_line><script_line><script_line_id>141:TEST</script_line_id><script_id>14:WPDS</script_id><sequence>2</sequence><script_class_id>7</script_class_id><source_name>LOCAL</source_name><row_version>1</row_version><lu_id>SNEHAI</lu_id><lu_date>2015-10-27T00:55:29</lu_date><statement>importPackage(Packages.com.workpoint.common.script);[lf]importPackage(Packages.com.workpoint.client);[lf]importPackage(Packages.com.workpoint.common.data);[lf]importPackage(Packages.com.workpoint.common.util);[lf][lf][lf]SymActID = SymbolTable.getSymbol("ActInstID").getPrimaryValue();[lf]SymActDB = SymbolTable.getSymbol("ActInstDB").getPrimaryValue();[lf]SymIteration = SymbolTable.getSymbol("WorkItemIteration").getPrimaryValue();[lf]activity = new TableID(SymActID + ":" + SymActDB);[lf][lf]work = WorkItemEntry.queryByID(ClientContext, activity, SymIteration);[lf][lf]if( work != null )[lf]{[lf]    workstate = work.getWorkStateID();[lf]    if( workstate == WorkItemConst.WORK_STATE_AVAILABLE ) // Available[lf]    {[lf]        work.openAndComplete(0);[lf]    }[lf]    else if( workstate == WorkItemConst.WORK_STATE_OPEN ) // Open[lf]    {[lf]        work.complete(0);[lf]    }[lf]}</statement><name/><validation_status>0</validation_status><validation_status_msg/></script_line><validation_status>0</validation_status></script>